{% extends 'base.html' %}
{% load static %}
{% block content %}
<!--Content Header-->
<section class="content-header">
    <h1>
        主机
        <small>控制台</small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i>Home</a></li>
        <li class="active">Manager</li>
        <li class="active">Host</li>
    </ol>
</section>
<!--Content Header-->
<!--Main Content-->
<section class="content container-fluid page-host">
    <div class="row">
        <div class="col-lg-12">
            <div class="box box-hosttb">
                <div class="box-header">
                    <h3 class="box-title">主机列表</h3>
                </div>
                <!-- /.box-header -->
                <div id="hst-toolbar">
                    <button class="btn btn-app" data-toggle="modal" data-target="#HostInfo" onclick="openModal('add')">
                        <i class="fa fa-plus"></i> 新增
                    </button>
                    <button class="btn btn-app" data-toggle="modal" data-target="#HostInfo" onclick="openModal('modify')">
                        <i class="fa fa-edit"></i> 修改
                    </button>
                    <button class="btn btn-app" disabled>
                        <i class="fa fa-info"></i> 信息
                    </button>
                    <select id="groupselect" onchange="SelectChange()">
                        <option id="0">Null</option>#}
                        {% for row in grouplist %}
                            <option id="{{ row.id }}">{{ row.name }}</option>
                        {% endfor %}
                    </select>
                </div>
{#                    <div class="row">#}
{#                        <div class="col-sm-6">#}
{#                            <label class="groupslct">展示#}
{#                                <select id="groupselect" onchange="SelectChange()">#}
{#                                <option id="0">Null</option>#}
{#                                    {% for row in grouplist %}#}
{#                                    <option id="{{ row.id }}">{{ row.name }}</option>#}
{#                                    {% endfor %}#}
{#                                </select>#}
{#                                主机列表#}
{#                            </label>#}
{#                        </div>#}
{#                        <div class="col-md-6">#}
{#                            <div class="box-toolbar-btn">#}
{#                                <button class="btn btn-app" data-toggle="modal" data-target="#HostInfo">#}
{#                                    <i class="fa fa-plus"></i> 新增#}
{#                                </button>#}
{#                                <button class="btn btn-app" data-toggle="modal" data-target="#HostInfo">#}
{#                                    <i class="fa fa-edit"></i> 修改#}
{#                                </button>#}
{#                                <button class="btn btn-app" disabled>#}
{#                                    <i class="fa fa-info"></i> 信息#}
{#                                </button>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
                    <div class="box-body">
                        <div class="row">
                            <div class="col-lg-12">
                                <table id="host_tb" class="table table-bordered table-striped">
                                    <thead>
                                    <tr>
                                        <th data-field="state" data-radio="true">#</th>
                                        <th data-field="id">主机ID</th>
                                        <th data-field="systemtype">操作系统</th>
                                        <th data-field="manage_ip">管理IP</th>
                                        <th data-field="service_ip">服务IP</th>
                                        <th data-field="outer_ip">外网IP</th>
                                        <th data-field="server_position">服务器位置</th>
                                        <th data-field="hostname">主机名称</th>
                                        <th data-field="info">用途</th>
                                    </tr>
                                    </thead>
                                    <tbody id="hosttbody">
                                    </tbody>
                                    <tfoot>
{#                                        <th>#</th>#}
{#                                        <th>主机ID</th>#}
{#                                        <th>操作系统</th>#}
{#                                        <th>管理IP</th>#}
{#                                        <th>服务IP</th>#}
{#                                        <th>外网IP</th>#}
{#                                        <th>服务器位置</th>#}
{#                                        <th>主机名称</th>#}
{#                                        <th>普通用户</th>#}
{#                                        <th>用户密码</th>#}
{#                                        <th>管理端口</th>#}
{#                                        <th>CPU核数</th>#}
{#                                        <th>内存大小(Mb)</th>#}
{#                                        <th>本地磁盘(Gb)</th>#}
{#                                        <th>共享磁盘(Gb)</th>#}
{#                                        <th>共享磁盘路径</th>#}
{#                                        <th>信息</th>#}
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- /.box-body -->
                </div>
            </div>
        </div>
    </div>
</section>
<!--Main Content-->
{% include "_host_modal.html" %}
{% endblock %}
{% block foot_js %}
    <script src="{% static 'js/jquery.form.min.js' %}"></script>
    <script src="{% static 'js/bootstrap-table.min.js'%}"></script>
    <script src="{% static 'js/bootstrap-table-export.min.js' %}"></script>
    <script src="{% static 'js/tableExport.min.js' %}"></script>
<script>

    function cleanForm(form){
        $(':input',form).each(function(){
            var type=this.type;
            var tag=this.tagName.toLowerCase();
            if(type=='text'||type=='password'||tag=='textarea'){
                this.value='';
            }else if(type=='checkbox'||type=='radio'){
                this.checked=false;
            }else if(tag=='select'){
                this.selectedIndex=-1;
            }
        });
    }

    function SelectChange(){
        var objSelect = document.getElementById('groupselect');
        var obj=objSelect.options[objSelect.selectedIndex].id;
        var url='/api-manager/v1/hostbygroup/'+obj;
        var table=$('#host_tb').bootstrapTable('refresh',
            {url :   url}
        );
    }

    function openModal(type) {
        if(type=='add'){//ADD
            cleanForm($('#form_host'));
            $('#id_id').val('#New');
            $('#modal-error').css('display','none');

        }else if(type=='modify'){//MODIFY
            $('#modal-error').css('display','none');
            var a=$('#host_tb').bootstrapTable('getSelections');
            if(a.length<1){
                alert('请选择数据');
            }
            else{
                $('#id_id').val(a[0].id);
                $('#id_systemtype').val(a[0].systemtype);
                $('#id_group').val(a[0].group);
                $('#id_manage_ip').val(a[0].manage_ip);
                $('#id_service_ip').val(a[0].service_ip);
                $('#id_outer_ip').val(a[0].outer_ip);
                $('#id_server_position').val(a[0].server_position);
                $('#id_hostname').val(a[0].hostname);
                $('#id_normal_user').val(a[0].normal_user);
                $('#id_sshpasswd').val(a[0].sshpasswd);
                $('#id_sshport').val(a[0].sshport);
                $('#id_coreness').val(a[0].coreness);
                $('#id_memory').val(a[0].memory);
                $('#id_root_disk').val(a[0].root_disk);
                $('#id_share_disk_path').val(a[0].share_disk_path);
                $('#id_share_disk').val(a[0].share_disk);
                $('#id_info').val(a[0].info);
            }
        }
    }

    $(document).ready(function () {
        $('#modal_host_id').click(function(){
                var ajax_option={
                    url:"/api-manager/v1/hostcreate/",
                    type:"post",
                    success:function (data,testStatus,jqXHR) {
                        if(data.success==true){
                            window.location.reload();
                        }else{
                            $('#modal-error').html(data.msg).css('display','block');
                        }
                    }
                };
                var $form=$('#form_host');
                $form.ajaxSubmit(ajax_option);
        })



            var table=$('#host_tb').bootstrapTable({
                url : '/api-manager/v1/hostbygroup/0',
                method  : 'GET',
                uniqueId :  'id',
                toolbar : '#hst-toolbar',
                search  :   true,
                sortable    :   false,
                pagination  :   true,
                showExport: true,
                sidePagination  : 'client',
                clickToSelect:  true,
                singleSelect    :   true,
                showRefresh :   true,
                showColumns :    true,
                detailView  :   true,
                pageSize    :   15,
                pageList    :   [10, 20, 30, 40],
                dataType    :   'json',
                showExport: true,
                exportDataType : "basic",
                onExpandRow :   function(index, row, $Subdetail){
                    var html=[];
                    $.each(row,function(key,value) {
                       html.push('<p><b>' + key + ':</b> ' + value + '</p>');
                    });
                    $Subdetail.html(html);
                },
                colums  :   [
                    {
                        checkbox:true
                    },
                    {
                        title:'主机ID',
                        field:'id',
                        align:'center'
                    },
                    {
                        title:'操作系统',
                        field:'systemtype',
                        align:'center'
                    },
                    {
                        title:'管理IP',
                        field:'manage_ip',
                        align:'center'
                    },
                    {
                        title:'服务IP',
                        field:'service_ip',
                        align:'center',
                    },
                    {
                        title:'外网IP',
                        field:'outer_ip',
                        align:'center',
                    },{
                        title:'服务器位置',
                        field:'server_position',
                        align:'center',
                    },{
                        title:'主机名称',
                        field:'hostname',
                        align:'center',
                    },{
                        title:'用途',
                        field:'info',
                        align:'center',
                    }
                ]
            });

        $('#modal_host_id').click(function(){
                var ajax_option={
                    url:"/api-manager/v1/hostcreate/",
                    type:"post",
                    success:function (data,testStatus,jqXHR) {
                        if(data.success==true){
                            window.location.reload();
                        }else{
                            $('#modal-error').html(data.msg).css('display','block');
                        }
                    }
                }
                var $form=$('#form_host');
                $form.ajaxSubmit(ajax_option);
            });
    })
</script>
{% endblock %}